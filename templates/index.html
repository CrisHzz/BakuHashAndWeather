<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BakuHashAndWeather</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="flag-stripe blue"></div>
            <div class="flag-stripe red"></div>
            <div class="flag-stripe green"></div>
            <h1 class="title">
                <span class="baku-text">Baku</span>
                <span class="hash-text">Hash</span>
                <span class="and-text">And</span>
                <span class="baku-text">Weather <img src="https://vectorflags.s3.amazonaws.com/flags/az-flag-01.png" width="100"></span>
            </h1>
            <p class="subtitle">Predicci√≥n del Clima de Bak√∫ y cifrado de datos</p>
        </header>

        <main class="main-content">
            <div class="form-container">
                <div class="form-header">
                    <h2>Datos Hist√≥ricos del Clima</h2>
                    <p>Ingresa los datos de los √∫ltimos 3 d√≠as para generar la predicci√≥n</p>
                </div>

                <form class="weather-form" id="weatherForm">
                    <!-- D√≠a 1 -->
                    <div class="day-section">
                        <h3 class="day-title">
                            <span class="day-number">1</span>
                            Hace 3 d√≠as
                        </h3>
                        <div class="input-group">
                            <div class="input-field">
                                <label for="day1-max">Temperatura M√°xima (¬∞C)</label>
                                <input type="number" id="day1-max" name="day1-max" min="-20" max="50" step="0.1" required>
                                <span class="input-icon">üå°Ô∏è</span>
                            </div>
                            <div class="input-field">
                                <label for="day1-min">Temperatura M√≠nima (¬∞C)</label>
                                <input type="number" id="day1-min" name="day1-min" min="-20" max="50" step="0.1" required>
                                <span class="input-icon">‚ùÑÔ∏è</span>
                            </div>
                            <div class="input-field">
                                <label for="day1-sun">Horas de Sol</label>
                                <input type="number" id="day1-sun" name="day1-sun" min="0" max="24" step="0.1" required>
                                <span class="input-icon">‚òÄÔ∏è</span>
                            </div>
                        </div>
                    </div>

                    <!-- D√≠a 2 -->
                    <div class="day-section">
                        <h3 class="day-title">
                            <span class="day-number">2</span>
                            Hace 2 d√≠as
                        </h3>
                        <div class="input-group">
                            <div class="input-field">
                                <label for="day2-max">Temperatura M√°xima (¬∞C)</label>
                                <input type="number" id="day2-max" name="day2-max" min="-20" max="50" step="0.1" required>
                                <span class="input-icon">üå°Ô∏è</span>
                            </div>
                            <div class="input-field">
                                <label for="day2-min">Temperatura M√≠nima (¬∞C)</label>
                                <input type="number" id="day2-min" name="day2-min" min="-20" max="50" step="0.1" required>
                                <span class="input-icon">‚ùÑÔ∏è</span>
                            </div>
                            <div class="input-field">
                                <label for="day2-sun">Horas de Sol</label>
                                <input type="number" id="day2-sun" name="day2-sun" min="0" max="24" step="0.1" required>
                                <span class="input-icon">‚òÄÔ∏è</span>
                            </div>
                        </div>
                    </div>

                    <!-- D√≠a 3 -->
                    <div class="day-section">
                        <h3 class="day-title">
                            <span class="day-number">3</span>
                            Ayer
                        </h3>
                        <div class="input-group">
                            <div class="input-field">
                                <label for="day3-max">Temperatura M√°xima (¬∞C)</label>
                                <input type="number" id="day3-max" name="day3-max" min="-20" max="50" step="0.1" required>
                                <span class="input-icon">üå°Ô∏è</span>
                            </div>
                            <div class="input-field">
                                <label for="day3-min">Temperatura M√≠nima (¬∞C)</label>
                                <input type="number" id="day3-min" name="day3-min" min="-20" max="50" step="0.1" required>
                                <span class="input-icon">‚ùÑÔ∏è</span>
                            </div>
                            <div class="input-field">
                                <label for="day3-sun">Horas de Sol</label>
                                <input type="number" id="day3-sun" name="day3-sun" min="0" max="24" step="0.1" required>
                                <span class="input-icon">‚òÄÔ∏è</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="predict-btn">
                            <span>üîÆ</span>
                            Generar Predicci√≥n
                        </button>
                        <button type="reset" class="reset-btn">
                            <span>üîÑ</span>
                            Limpiar Datos
                        </button>
                    </div>
                </form>
            </div>
        </main>

        <footer class="footer">
            <div class="cultural-elements">
                <span class="element">üèõÔ∏è Patrimonio de Bak√∫</span>
                <span class="element">üî• Torres de la Llama</span>
                <span class="element">üåä Mar Caspio</span>
            </div>
            <p>&copy; 2024 BakuHashAndWeather - Predicci√≥n del Clima de Azerbaiy√°n</p>
        </footer>
    </div>

    <!-- Modal para mostrar resultados -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="resultContent">
                <!-- Los resultados se mostrar√°n aqu√≠ -->
            </div>
        </div>
    </div>

    <script>
        document.getElementById('weatherForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Obtener todos los datos del formulario
            const formData = new FormData(this);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Mostrar indicador de carga
            const submitBtn = document.querySelector('.predict-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span>‚è≥</span> Generando Predicci√≥n...';
            submitBtn.disabled = true;
            
            try {
                // Enviar datos al servidor
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult(result);
                } else {
                    showError(result.error || 'Error en la predicci√≥n');
                }
                
            } catch (error) {
                showError('Error de conexi√≥n: ' + error.message);
            } finally {
                // Restaurar bot√≥n
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });
        
        function showResult(result) {
            const prediction = result.Prediction[0];
            const modal = document.getElementById('resultModal');
            const content = document.getElementById('resultContent');
            
            content.innerHTML = `
                <div class="result-header">
                    <h2>üîÆ Predicci√≥n del Clima</h2>
                    <p>Bak√∫, Azerbaiy√°n</p>
                </div>
                <div class="prediction-card">
                    <div class="temp-display">
                        <span class="temp-number">${prediction.temperature_Prediction}¬∞C</span>
                        <span class="temp-label">Temperatura M√°xima Predicha</span>
                    </div>
                    <div class="weather-info">
                        <div class="weather-type">
                            <span class="weather-icon">${getWeatherIcon(prediction.estimated_weather)}</span>
                            <span class="weather-text">${prediction.estimated_weather}</span>
                        </div>
                        <div class="explanation">
                            <p>${prediction.Explication}</p>
                        </div>
                    </div>
                </div>
                <button onclick="closeModal()" class="close-btn">
                    <span>‚úÖ</span> Entendido
                </button>
                <div class="json-section">
                    <h3>üìã JSON de Respuesta</h3>
                    <div class="json-container">
                        <pre id="jsonOutput">${JSON.stringify(result, null, 2)}</pre>
                        <button onclick="copyToClipboard()" class="copy-btn">
                            <span>üìã</span> Copiar JSON
                        </button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function showError(message) {
            const modal = document.getElementById('resultModal');
            const content = document.getElementById('resultContent');
            
            content.innerHTML = `
                <div class="error-content">
                    <h2>‚ùå Error</h2>
                    <p>${message}</p>
                    <button onclick="closeModal()" class="close-btn error">
                        <span>üîÑ</span> Intentar Nuevamente
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function getWeatherIcon(weather) {
            switch(weather.toLowerCase()) {
                case 'caluroso': return 'üåû';
                case 'templado': return 'üå§Ô∏è';
                case 'fresco': return 'üå•Ô∏è';
                default: return 'üå§Ô∏è';
            }
        }
        
        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }
        
        function copyToClipboard() {
            const jsonText = document.getElementById('jsonOutput').textContent;
            navigator.clipboard.writeText(jsonText).then(function() {
                // Cambiar el texto del bot√≥n temporalmente
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span>‚úÖ</span> ¬°Copiado!';
                btn.style.background = 'linear-gradient(45deg, #00AA00, #00CC33)';
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(function(err) {
                console.error('Error al copiar: ', err);
                alert('Error al copiar al portapapeles');
            });
        }
        
        // Cerrar modal al hacer clic fuera de √©l
        window.onclick = function(event) {
            const modal = document.getElementById('resultModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // Cerrar modal con la X
        document.querySelector('.close').onclick = function() {
            closeModal();
        }
    </script>
</body>
</html>